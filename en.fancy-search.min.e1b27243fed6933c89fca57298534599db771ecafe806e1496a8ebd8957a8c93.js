"use strict";(function(e){e.addEvent=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)},e.removeEvent=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n)},e.onReady=function(e){document.readyState!="loading"?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.attachEvent("onreadystatechange",function(){document.readyState=="complete"&&e()})};const o=document.getElementById("search-input");function n(){var e=new XMLHttpRequest;e.open("GET","/en.fancy-search-data.4a17d3ff51349d68b58b36eea6982b142a464a842f75fed6f87532fcf4df8d73.json",!0),e.onload=function(){if(e.status>=200&&e.status<400){var n,t=JSON.parse(e.responseText);lunr.tokenizer.separator=/[\s\-_]+/,n=lunr(function(){this.ref("id"),this.field("title",{boost:200}),this.field("content",{boost:2}),this.field("relUrl"),this.metadataWhitelist=["position"];for(var e in t)this.add({id:e,title:t[e].title,content:t[e].content,relUrl:t[e].relUrl})}),s(n,t)}else console.log("Error loading ajax request. Request status:"+e.status)},e.onerror=function(){console.log("There was a connection error")},e.send()}function s(t,n){var a,t=t,n=n,s=document.getElementById("search-input"),o=document.getElementById("search-results"),d=document.getElementById("book-search"),i=0;function l(){document.documentElement.classList.add("search-active")}function r(){document.documentElement.classList.remove("search-active")}function c(){i++;var c,d,u,h,e=s.value;if(e===""?r():(l(),window.scroll(0,-1),setTimeout(function(){window.scroll(0,0)},0)),e===a)return;if(a=e,o.innerHTML="",e==="")return;c=t.query(function(t){var n=lunr.tokenizer(e);t.term(n,{boost:10}),t.term(n,{wildcard:lunr.Query.wildcard.LEADING|lunr.Query.wildcard.TRAILING})}),c.length==0&&e.length>2&&(h=lunr.tokenizer(e).filter(function(e){return e.str.length<20}),h.length>0&&(c=t.query(function(t){t.term(h,{editDistance:Math.round(Math.sqrt(e.length/2-1))})}))),c.length==0?(d=document.createElement("div"),d.classList.add("search-no-result"),d.innerText="No results found",o.appendChild(d)):(u=document.createElement("ul"),u.classList.add("search-results-list"),o.appendChild(u),m(u,c,0,10,100,i));function m(e,t,n,s,o,a){if(a!=i)return;for(var r=n;r<n+s;r++){if(r==t.length)return;p(e,t[r])}setTimeout(function(){m(e,t,n+s,s,o,a)},o)}function p(e,t){var s,i,a,r,c,l,d,u,h,m,p,g,v,b,j,y,_,w,O,x,C,E,k,A,S,M,T,o=n[t.ref],F=document.createElement("li");F.classList.add("search-results-list-item"),e.appendChild(F),g=document.createElement("a"),g.classList.add("search-result"),g.setAttribute("href",o.url),F.appendChild(g),p=document.createElement("div"),p.classList.add("search-result-title"),g.appendChild(p),j=document.createElement("div"),j.classList.add("search-result-doc"),j.innerHTML='<svg viewBox="0 0 24 24" class="search-result-icon"><use xlink:href="#svg-doc"></use></svg>',p.appendChild(j),O=document.createElement("div"),O.classList.add("search-result-doc-title"),O.innerHTML=o.doc,j.appendChild(O),S=O,o.doc!=o.title&&(j.classList.add("search-result-doc-parent"),y=document.createElement("div"),y.classList.add("search-result-section"),y.innerHTML=o.title,p.appendChild(y),S=y),M=t.matchData.metadata,_=[],u=[];for(a in M){if(w=M[a],w.title){b=w.title.position;for(r in b)_.push(b[r])}if(w.content){b=w.content.position;for(r in b){i=b[r],m=i[0],h=i[0]+i[1],C=!0,x=!0;for(r=0;r<5;r++){if(l=o.content.lastIndexOf(" ",m-2),d=o.content.lastIndexOf(". ",m-2),d>=0&&d>l){m=d+1,C=!1;break}if(l<0){m=0,C=!1;break}m=l+1}for(r=0;r<10;r++){if(l=o.content.indexOf(" ",h+1),d=o.content.indexOf(". ",h+1),d>=0&&d<l){h=d,x=!1;break}if(l<0){h=o.content.length,x=!1;break}h=l}u.push({highlight:i,previewStart:m,previewEnd:h,ellipsesBefore:C,ellipsesAfter:x})}}}if(_.length>0&&(_.sort(function(e,t){return e[0]-t[0]}),S.innerHTML="",f(S,o.title,0,o.title.length,_)),u.length>0){u.sort(function(e,t){return e.highlight[0]-t.highlight[0]}),s=u[0],c={highlight:[s.highlight],previewStart:s.previewStart,previewEnd:s.previewEnd,ellipsesBefore:s.ellipsesBefore,ellipsesAfter:s.ellipsesAfter},k=[c];for(a=1;a<u.length;a++)s=u[a],c.previewEnd<s.previewStart?(c={highlight:[s.highlight],previewStart:s.previewStart,previewEnd:s.previewEnd,ellipsesBefore:s.ellipsesBefore,ellipsesAfter:s.ellipsesAfter},k.push(c)):(c.highlight.push(s.highlight),c.previewEnd=s.previewEnd,c.ellipsesAfter=s.ellipsesAfter);A=document.createElement("div"),A.classList.add("search-result-previews"),g.appendChild(A),T=o.content;for(a=0;a<Math.min(k.length,3);a++)i=k[a],v=document.createElement("div"),v.classList.add("search-result-preview"),A.appendChild(v),i.ellipsesBefore&&v.appendChild(document.createTextNode("... ")),f(v,T,i.previewStart,i.previewEnd,i.highlight),i.ellipsesAfter&&v.appendChild(document.createTextNode(" ..."))}E=document.createElement("span"),E.classList.add("search-result-rel-url"),E.innerText=o.relUrl,p.appendChild(E)}function f(e,t,n,s,o){var i,a,c,l,r=n;for(l in o)a=o[l],i=document.createElement("span"),i.innerHTML=t.substring(r,a[0]),e.appendChild(i),r=a[0]+a[1],c=document.createElement("span"),c.classList.add("search-result-highlight"),c.innerHTML=t.substring(a[0],r),e.appendChild(c);i=document.createElement("span"),i.innerHTML=t.substring(r,s),e.appendChild(i)}}e.addEvent(s,"focus",function(){setTimeout(c,0)}),e.addEvent(s,"keyup",function(e){switch(e.keyCode){case 27:s.value="";break;case 38:case 40:case 13:e.preventDefault();return}c()}),e.addEvent(s,"keydown",function(e){switch(e.keyCode){case 38:e.preventDefault();var n,s,o,t=document.querySelector(".search-result.active");t&&(t.classList.remove("active"),t.parentElement.previousSibling&&(o=t.parentElement.previousSibling.querySelector(".search-result"),o.classList.add("active")));return;case 40:e.preventDefault(),t=document.querySelector(".search-result.active"),t?t.parentElement.nextSibling&&(n=t.parentElement.nextSibling.querySelector(".search-result"),t.classList.remove("active"),n.classList.add("active")):(n=document.querySelector(".search-result"),n&&n.classList.add("active"));return;case 13:e.preventDefault(),t=document.querySelector(".search-result.active"),t?t.click():(s=document.querySelector(".search-result"),s&&s.click());return}}),e.addEvent(document,"click",function(e){e.target!=s&&r()})}e.onReady(function(){n()})})(window.jtd=window.jtd||{})